<ng-template #titleContent>
    <div class="app-page-title">
        <ng-container *ngIf="!loading"> Wallets </ng-container>
        <ng-container *ngIf="loading"> Loading </ng-container>
    </div>
    <div class="app-page-subtitle">See account distribution statistics and the list of the top banano holders.</div>
</ng-template>

<ng-template #bodyContent>
    <div class="app-section-title">BAN Distribution Chart</div>
    <div class="app-section-subtitle">The chart below shows the distribution of banano among all opened accounts.</div>
    <mat-card class="wallets-chart mat-elevation-z2" responsive>
        <highcharts-chart
            [update]="true"
            [Highcharts]="Highcharts"
            [options]="distributionChart"
            style="pointer-events: none; width: 100%"
            [style.height.px]="vp.sm ? 300 : vp.md ? 350 : 400"
        ></highcharts-chart>
    </mat-card>

    <div class="app-section-title">All Accounts</div>
    <div class="app-section-subtitle" [style.marginBottom.px]="4">All banano accounts, sorted by balance.</div>
    <div class="app-caption" [style.marginBottom.px]="24">
        Any account with an offline representative is marked with a warning flag. It is encouraged that these accounts
        change their representative if their current rep is constantly offline.
    </div>
    <ng-template #paginator>
        <app-paginator
            responsive
            [pageSize]="pageSize"
            [maxElements]="totalAccounts"
            [(pageIndex)]="currentPage"
            (pageIndexChange)="loadAccountBalances($event)"
            [disableMove]="loadingNewAccountBalancePage"
        ></app-paginator>
    </ng-template>
    <ng-template [ngTemplateOutlet]="paginator"></ng-template>
    <ng-container *ngIf="isMegaphone">
        <button mat-flat-button color="primary" (click)="toot()" style="margin-right: 24px" [disabled]="megaSuccess">
            <ng-container *ngIf="!megaSuccess">Use Megaphone</ng-container>
            <ng-container *ngIf="megaSuccess">All is Good</ng-container>
        </button>
    </ng-container>
    <table
        mat-table
        *ngIf="accountBalances.length > 0"
        [style.width.%]="100"
        [dataSource]="accountBalances"
        class="wallets-rich-list-table mat-elevation-z2"
        responsive
    >
        <ng-container matColumnDef="position">
            <th mat-header-cell *matHeaderCellDef></th>
            <td
                mat-cell
                [style.paddingRight.px]="20"
                [style.paddingLeft.px]="vp.sm ? 16 : 'inherit'"
                *matCellDef="let element; let i = index"
            >
                <span
                    matBadgeColor="warn"
                    matBadgeOverlap="false"
                    [matBadgeSize]="vp.sm ? 'small' : 'medium'"
                    [matBadge]="showWarningBadge(element.representative) ? '!' : undefined"
                >
                    #{{ formatIndex(i + 1 + currentPage * pageSize) }}
                </span>
            </td>
        </ng-container>

        <ng-container matColumnDef="megaphone">
            <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
            <td mat-cell *matCellDef="let element">
                <div
                    style="display: flex"
                    *ngIf="!megaphone.hasAddress(element.address) && showWarningBadge(element.representative)"
                >
                    <button
                        mat-stroked-button
                        color="accent"
                        (click)="megaphone.addAddress(element.address, 2)"
                        [style.marginRight.px]="16"
                    >
                        Add
                    </button>
                </div>
                <ng-container *ngIf="megaphone.hasAddress(element.address)">
                    <button mat-stroked-button color="warn" (click)="megaphone.removeAddress(element.address)">
                        Exclude
                    </button>
                </ng-container>
            </td>
        </ng-container>

        <ng-container matColumnDef="addr">
            <th mat-header-cell *matHeaderCellDef>Address</th>
            <td
                mat-cell
                [style.paddingTop.px]="12"
                [style.paddingBottom.px]="12"
                class="wallets-address-cell"
                *matCellDef="let element"
            >
                <div
                    *ngIf="aliasService.has(element.address)"
                    class="wallets-table-alias primary"
                    style="margin-bottom: -2px; word-break: break-word"
                >
                    {{ aliasService.get(element.address) }}
                </div>
                <a
                    class="address link"
                    style="color: inherit"
                    (click)="routeRepAddress(element.address, $event)"
                >
                    {{ element.address }}
                </a>
            </td>
        </ng-container>
        <ng-container matColumnDef="ban">
            <th mat-header-cell [style.paddingLeft.px]="16" *matHeaderCellDef>Amount</th>
            <td mat-cell style="padding: 8px 16px 8px 16px" *matCellDef="let element">
                <div style="display: flex; align-items: center">
                    <!--<span [style.fontSize.px]="vp.sm ? 8 : 12">üçå</span>-->
                    <img
                        src="assets/banano-mark.svg"
                        [width]="vp.sm ? 16 : 20"
                        [height]="vp.sm ? 16 : 20"
                        style="margin-right: 4px"
                    />
                    {{ formatBanAmount(element.amount) }}
                </div>
                <div class="wallets-rich-list-conversion">
                    <div>
                        {{ formatUsdPrice(element.amount) | currency }} ¬∑
                        {{ formatBtcPrice(element.amount) }}
                    </div>
                </div>
            </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="columns"></tr>
        <tr mat-row *matRowDef="let row; columns: columns"></tr>
    </table>
    <ng-template [ngTemplateOutlet]="paginator"></ng-template>
</ng-template>

<div class="app-page-root" responsive>
    <div class="app-page-content">
        <app-error *ngIf="error"></app-error>
        <ng-container *ngIf="!error">
            <ng-template [ngTemplateOutlet]="titleContent"></ng-template>
            <ng-template *ngIf="!loading" [ngTemplateOutlet]="bodyContent"></ng-template>
        </ng-container>
    </div>
</div>

<app-wave [darkThemeWaveNumber]="5"></app-wave>
